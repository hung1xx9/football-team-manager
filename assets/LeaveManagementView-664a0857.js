import{_ as $,g as i,q as G,c as M,a as o,b as t,w,j as O,v as V,t as a,F as U,r as F,f as N,u as k,i as u,n as x,e as J,o as d}from"./index-5ced725b.js";const z={class:"page-content"},E={class:"card"},K={class:"card-content"},Q={class:"filters"},H={class:"form-group",style:{margin:"0"}},P={class:"form-group",style:{margin:"0"}},W={class:"stats-grid",style:{"grid-template-columns":"repeat(auto-fit, minmax(150px, 1fr))",margin:"2rem 0"}},Y={class:"stat-card stat-warning"},Z={class:"stat-content"},q={class:"stat-value"},tt={class:"stat-card stat-success"},et={class:"stat-content"},st={class:"stat-value"},lt={class:"stat-card stat-danger"},nt={class:"stat-content"},at={class:"stat-value"},ot={key:0},dt={class:"table-container"},it={class:"data-table"},ut={style:{"max-width":"300px"}},rt={style:{display:"flex",gap:"0.5rem"}},vt=["onClick"],ct=["onClick"],pt=["onClick"],gt={key:1,class:"empty-state"},mt={key:0,class:"modal",style:{display:"flex"}},ht={class:"modal-content"},_t={class:"modal-header"},yt={class:"modal-body"},bt={key:0},ft={class:"form-group",style:{"margin-top":"1rem"}},wt={class:"form-actions"},Nt={key:1,class:"modal",style:{display:"flex"}},kt={class:"modal-content"},xt={class:"modal-header"},Tt={key:0,class:"modal-body"},Ct={class:"detail-row"},Dt={class:"detail-row"},Lt={class:"detail-row"},St={class:"detail-row"},Mt={class:"detail-row"},Vt={key:0,class:"detail-row"},At={__name:"LeaveManagementView",setup(jt){const{members:It,getMemberName:g}=J(),r=i([]),m=i("all"),h=i(""),_=i(!1),y=i(!1),n=i(null),v=i("approve"),c=i("");G(()=>{A()});const A=()=>{const s=localStorage.getItem("leaveRequests");r.value=s?JSON.parse(s):[]},j=()=>{localStorage.setItem("leaveRequests",JSON.stringify(r.value))},b=M(()=>({pending:r.value.filter(s=>s.status==="pending").length,approved:r.value.filter(s=>s.status==="approved").length,rejected:r.value.filter(s=>s.status==="rejected").length})),T=M(()=>{let s=r.value;if(m.value!=="all"&&(s=s.filter(e=>e.status===m.value)),h.value){const e=h.value.toLowerCase();s=s.filter(l=>{const p=g(l.memberId);return p&&p.toLowerCase().includes(e)})}return s.sort((e,l)=>new Date(l.createdAt)-new Date(e.createdAt))}),I=s=>{n.value=s,v.value="approve",c.value="",_.value=!0},R=s=>{n.value=s,v.value="reject",c.value="",_.value=!0},C=()=>{_.value=!1,n.value=null,c.value=""},X=()=>{if(!n.value)return;const s=r.value.find(e=>e.id===n.value.id);if(s){s.status=v.value==="approve"?"approved":"rejected",s.adminNote=c.value.trim()||null,s.processedAt=new Date().toISOString(),j();const e=v.value==="approve"?"✅ Đã duyệt đơn xin nghỉ":"❌ Đã từ chối đơn xin nghỉ";alert(e)}C()},B=s=>{n.value=s,y.value=!0},D=s=>({pending:"badge-warning",approved:"badge-success",rejected:"badge-danger"})[s]||"badge-info",L=s=>({pending:"Chờ duyệt",approved:"Đã duyệt",rejected:"Từ chối"})[s]||s,f=s=>s?new Date(s).toLocaleDateString("vi-VN"):"",S=s=>s?new Date(s).toLocaleString("vi-VN"):"";return(s,e)=>(d(),o("div",z,[t("div",E,[e[12]||(e[12]=t("div",{class:"card-header"},[t("h2",null,"Quản Lý Đơn Xin Nghỉ")],-1)),t("div",K,[t("div",Q,[t("div",H,[e[5]||(e[5]=t("label",null,"Lọc theo trạng thái",-1)),w(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l)},[...e[4]||(e[4]=[t("option",{value:"all"},"Tất cả",-1),t("option",{value:"pending"},"Chờ duyệt",-1),t("option",{value:"approved"},"Đã duyệt",-1),t("option",{value:"rejected"},"Từ chối",-1)])],512),[[O,m.value]])]),t("div",P,[e[6]||(e[6]=t("label",null,"Tìm kiếm thành viên",-1)),w(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l),placeholder:"Nhập tên..."},null,512),[[V,h.value]])])]),t("div",W,[t("div",Y,[t("div",Z,[e[7]||(e[7]=t("div",{class:"stat-label"},"Chờ duyệt",-1)),t("div",q,a(b.value.pending),1)])]),t("div",tt,[t("div",et,[e[8]||(e[8]=t("div",{class:"stat-label"},"Đã duyệt",-1)),t("div",st,a(b.value.approved),1)])]),t("div",lt,[t("div",nt,[e[9]||(e[9]=t("div",{class:"stat-label"},"Từ chối",-1)),t("div",at,a(b.value.rejected),1)])])]),T.value.length>0?(d(),o("div",ot,[t("div",dt,[t("table",it,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Thành Viên"),t("th",null,"Ngày Nghỉ"),t("th",null,"Lý Do"),t("th",null,"Ngày Gửi"),t("th",null,"Trạng Thái"),t("th",null,"Thao Tác")])],-1)),t("tbody",null,[(d(!0),o(U,null,F(T.value,l=>(d(),o("tr",{key:l.id},[t("td",null,[t("strong",null,a(k(g)(l.memberId)),1)]),t("td",null,a(f(l.leaveDate)),1),t("td",ut,a(l.reason),1),t("td",null,a(S(l.createdAt)),1),t("td",null,[t("span",{class:x(["badge",D(l.status)])},a(L(l.status)),3)]),t("td",null,[t("div",rt,[l.status==="pending"?(d(),o("button",{key:0,class:"btn btn-sm btn-success",onClick:p=>I(l)}," Duyệt ",8,vt)):u("",!0),l.status==="pending"?(d(),o("button",{key:1,class:"btn btn-sm btn-danger",onClick:p=>R(l)}," Từ chối ",8,ct)):u("",!0),l.status!=="pending"?(d(),o("button",{key:2,class:"btn btn-sm btn-secondary",onClick:p=>B(l)}," Xem ",8,pt)):u("",!0)])])]))),128))])])])])):(d(),o("div",gt,[...e[11]||(e[11]=[t("p",null,"Không có đơn xin nghỉ nào",-1)])]))])]),_.value?(d(),o("div",mt,[t("div",ht,[t("div",_t,[t("h2",null,a(v.value==="approve"?"Duyệt Đơn":"Từ Chối Đơn"),1),t("button",{class:"modal-close",onClick:C},"x")]),t("div",yt,[n.value?(d(),o("div",bt,[t("p",null,[e[13]||(e[13]=t("strong",null,"Thành viên:",-1)),N(" "+a(k(g)(n.value.memberId)),1)]),t("p",null,[e[14]||(e[14]=t("strong",null,"Ngày nghỉ:",-1)),N(" "+a(f(n.value.leaveDate)),1)]),t("p",null,[e[15]||(e[15]=t("strong",null,"Lý do:",-1)),N(" "+a(n.value.reason),1)])])):u("",!0),t("div",ft,[e[16]||(e[16]=t("label",null,"Ghi chú (tùy chọn)",-1)),w(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>c.value=l),rows:"3",placeholder:"Nhập ghi chú cho thành viên..."},null,512),[[V,c.value]])]),t("div",wt,[t("button",{class:x(["btn",v.value==="approve"?"btn-success":"btn-danger"]),onClick:X},a(v.value==="approve"?"Xác Nhận Duyệt":"Xác Nhận Từ Chối"),3)])])])])):u("",!0),y.value?(d(),o("div",Nt,[t("div",kt,[t("div",xt,[e[17]||(e[17]=t("h2",null,"Chi Tiết Đơn Xin Nghỉ",-1)),t("button",{class:"modal-close",onClick:e[3]||(e[3]=l=>y.value=!1)},"x")]),n.value?(d(),o("div",Tt,[t("div",Ct,[e[18]||(e[18]=t("strong",null,"Thành viên:",-1)),t("span",null,a(k(g)(n.value.memberId)),1)]),t("div",Dt,[e[19]||(e[19]=t("strong",null,"Ngày nghỉ:",-1)),t("span",null,a(f(n.value.leaveDate)),1)]),t("div",Lt,[e[20]||(e[20]=t("strong",null,"Lý do:",-1)),t("span",null,a(n.value.reason),1)]),t("div",St,[e[21]||(e[21]=t("strong",null,"Ngày gửi:",-1)),t("span",null,a(S(n.value.createdAt)),1)]),t("div",Mt,[e[22]||(e[22]=t("strong",null,"Trạng thái:",-1)),t("span",{class:x(["badge",D(n.value.status)])},a(L(n.value.status)),3)]),n.value.adminNote?(d(),o("div",Vt,[e[23]||(e[23]=t("strong",null,"Ghi chú Admin:",-1)),t("span",null,a(n.value.adminNote),1)])):u("",!0)])):u("",!0)])])):u("",!0)]))}},Xt=$(At,[["__scopeId","data-v-049c4876"]]);export{Xt as default};
